@if (data() && data()!.pointsPerGame.length > 0) {
  @let idx = currentIndex()();
  @let pointsPerGame = data()!.pointsPerGame;
  @let accumulatedPoints = data()!.accumulatedPoints;
  @let count = pointsPerGame.length;

  <div class="control-elements">
    <div>
      <button mat-icon-button (click)="currentIndex().set(0)" [disabled]="idx === 0">
        <mat-icon>first_page</mat-icon>
      </button>
      <button mat-icon-button (click)="currentIndex().set(idx > 0 ? idx - 1 : idx)" [disabled]="idx === 0">
        <mat-icon>keyboard_arrow_left</mat-icon>
      </button>

      <mat-form-field subscriptSizing="dynamic">
        <mat-label>Spieltag</mat-label>
        <mat-select [value]="idx" (selectionChange)="onSelectionChanged($event)">
          @for (matchDay of pointsPerGame; track matchDay.gameId; let idx = $index) {
            <mat-option [value]="idx">{{matchDay.datetime | date:'dd.MM.yyyy'}}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <button mat-icon-button (click)="currentIndex().set(count - 1 ? idx + 1 : idx)" [disabled]="idx >= count - 1">
        <mat-icon>keyboard_arrow_right</mat-icon>
      </button>
      <button mat-icon-button (click)="currentIndex().set(count - 1)" [disabled]="idx >= count - 1">
        <mat-icon>last_page</mat-icon>
      </button>
    </div>
    <div>
      <mat-button-toggle-group class="view-type-buttons" [formControl]="viewTypeControl" [hideSingleSelectionIndicator]="true">
        <mat-button-toggle [value]="false">
          <mat-icon>unfold_less</mat-icon>
          kompakt
        </mat-button-toggle>
        <mat-button-toggle [value]="true">
          <mat-icon>unfold_more</mat-icon>
          detailliert
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
  </div>

  <button mat-button (click)="showHelpDialog()">
    <mat-icon>help</mat-icon>
    Wie funktioniert die Punktevergabe?
  </button>

  <ng-template #helpText>
    <p>Für jedes Spiel werden folgende Punkte vergeben:</p>
    <ul>
      <li>
        <strong>1. Platz:</strong>
        7 Punkte
      </li>
      <li>
        <strong>2. Platz:</strong>
        5 Punkte
      </li>
      <li>
        <strong>3. Platz:</strong>
        4 Punkte
      </li>
      <li>
        <strong>4. Platz:</strong>
        3 Punkte
      </li>
      <li>
        <strong>5. Platz:</strong>
        2 Punkte
      </li>
      <li>
        <strong>ab 6. Platz:</strong>
        1 Punkt
      </li>
      <li>
        <strong>keine Teilnahme:</strong>
        0 Punkte
      </li>
    </ul>
    <p>Sollte es vorkommen, dass sich mehrere Spieler den selben Platz teilen, erhält jeder dieser Spieler die entsprechende Punktzahl.</p>
    <p>Die o.g. Rangliste ergibt sich aus den erspielten Spielpunkten. Diese setzen sich aus 3 Bestandteilen zusammen:</p>
    <ul>
      <li>
        <strong>Rundenpkt.:</strong>
        <ul>
          <li>0 Rundenpunkte für den Verlierer einer Runde</li>
          <li>1 Rundenpunkt für Finalisten bzw. bei Schock-Aus-Strafe</li>
          <li>3 Rundenpunkte für Nicht-Finalisten bzw. bei Schock-Aus</li>
        </ul>
      </li>
      <li>
        <strong>Bonuspkt.:</strong>
        <ul>
          <li>1 Bonuspunkt pro Schock-Aus</li>
        </ul>
      </li>
      <li>
        <strong>Strafpkt.:</strong>
        <ul>
          <li>1 Strafpunkt pro Niederlage</li>
          <li>1 Strafpunkt pro 2-2-1</li>
          <li>3 Strafpunkte pro Lustwurf</li>
        </ul>
      </li>
    </ul>
    <p>
      Die Spielpunkte berechnen sich dann wie folgt:
      <br/>
      <i>Spielpunkte = Rundenpkt. + Bonuspkt. - Strafpkt.</i>
    </p>
    <p>
      Die Rangliste ergibt sich anhand folgender Kriterien in der angegebenen Reihenfolge:
      <br/>
      <i>mehr Spielpunkte, mehr Rundenpunkte, mehr Bonuspunkte, weniger Strafpunkte</i>
    </p>
    <p>Sollte es dennoch zu einer Punktgleichheit kommen, teilen sich die jeweiligen Spieler die Platzierung.</p>
  </ng-template>

  <h2>Punkte am {{pointsPerGame[idx].datetime | date:'dd.MM.yyyy'}}</h2>
  <hop-points-table [data]="pointsPerGame[idx].points" [loading]="loading()" [isExpanded]="!!viewTypeControl.value"></hop-points-table>

  @if (count > 1 && idx > 0) {
    <h2>Punkte vom {{pointsPerGame[0].datetime | date:'dd.MM.yyyy'}} bis {{pointsPerGame[idx].datetime | date:'dd.MM.yyyy'}}</h2>
    <hop-points-table [data]="accumulatedPoints[idx].points" [loading]="loading()" [isExpanded]="!!viewTypeControl.value"></hop-points-table>
  }
} @else if (!loading()) {
  <p class="no-data">Es gibt keine Daten für die ausgewählten Filter.</p>
}
